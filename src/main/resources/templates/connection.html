<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
   <meta name="description" content="">
   <meta name="author" content="">
   <link rel="icon" type="image/png" th:href="@{/img/fav.png}">
   <title></title>
   <!-- Slick Slider -->
   <link rel="stylesheet" type="text/css" th:href="@{/assets/slick/slick.min.css}"/>
   <link rel="stylesheet" type="text/css" th:href="@{/assets/slick/slick-theme.min.css}"/>
   <!-- Feather Icon-->
   <link th:href="@{/assets/icons/feather.css}" rel="stylesheet" type="text/css">
   <!-- Bootstrap core CSS -->
   <link th:href="@{/bootstrap/css/wbbootstrap.min.css}" rel="stylesheet">
   <!-- Custom styles for this template -->
   <link th:href="@{/assets/css/wbstyle.css}" rel="stylesheet">
</head>
   <body>
   <style>
      [v-cloak] {
         display: none;
      }

      .img-mini {
         width: 20%;
         height: 20%;
      }

      img {
         cursor: pointer;
      }
   </style>
   <div id="app" v-cloak>
      <!-- Navigation -->
      <div th:replace="main :: #MainNav"></div>   <!-- Navigation -->
      <div class="py-4">
         <div class="container">
            <div class="row">
               <!-- Main Content -->
               <main class="col col-xl-9 order-xl-2 col-lg-12 order-lg-1 col-md-12 col-sm-12 col-12">
                  <div class="box shadow-sm border rounded bg-white mb-3 osahan-share-post">
                     <h5 class="pl-3 pt-3 pr-3 border-bottom mb-0 pb-3">More suggestions for you</h5>
                     <ul class="nav border-bottom osahan-line-tab" id="myTab" role="tablist">
                        <li class="nav-item">
                           <a class="nav-link active" id="home-tab" data-toggle="tab" href="#fs" role="tab" aria-controls="fs" aria-selected="true">我的粉丝</a>
                        </li>
                        <li class="nav-item">
                           <a class="nav-link" id="profile-tab" data-toggle="tab" href="#gz" role="tab" aria-controls="gz" aria-selected="false">我的关注</a>
                        </li>
                     </ul>
                     <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="fs" role="tabpanel" aria-labelledby="home-tab">
                           <div class="p-3">
                              <div class="row">
                                 <div class="col-md-4">
                                    <a href="profile.html">
                                       <div class="border network-item rounded mb-3">
                                          <div class="p-3 d-flex align-items-center network-item-header">
                                             <div class="dropdown-list-image mr-3">
                                                <img class="rounded-circle" src="img/p1.png" alt="">
                                             </div>
                                             <div class="font-weight-bold">
                                                <h6 class="font-weight-bold text-dark mb-0">Sophia Lee</h6>
                                                <div class="small text-black-50">Photographer at Photography</div>
                                             </div>
                                          </div>
                                          <div class="d-flex align-items-center p-3 border-top border-bottom network-item-body">
                                             <div class="overlap-rounded-circle">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Sophia Lee" src="img/p1.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="John Doe" src="img/p2.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Julia Cox" src="img/p3.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Robert Cook" src="img/p4.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Sophia Lee" src="img/p5.png" alt="">
                                             </div>
                                             <span class="font-weight-bold small text-primary">4 mutual connections</span>
                                          </div>
                                          <div class="network-item-footer py-3 d-flex text-center">
                                             <div class="col-6 pl-3 pr-1">
                                                <button type="button" class="btn btn-primary btn-sm btn-block"> Connect </button>
                                             </div>
                                             <div class="col-6 pr-3 pl-1">
                                                <button type="button" class="btn btn-outline-primary btn-sm btn-block"> <i class="feather-user-plus"></i> Follow </button>
                                             </div>
                                          </div>
                                       </div>
                                    </a>
                                 </div>
                                 <div class="col-md-4">
                                    <a href="profile.html">
                                       <div class="border network-item rounded mb-3">
                                          <div class="p-3 d-flex align-items-center network-item-header">
                                             <div class="dropdown-list-image mr-3">
                                                <img class="rounded-circle" src="img/p2.png" alt="">
                                             </div>
                                             <div class="font-weight-bold">
                                                <h6 class="font-weight-bold text-dark mb-0">John Doe</h6>
                                                <div class="small text-black-50">Traveler</div>
                                             </div>
                                          </div>
                                          <div class="d-flex align-items-center p-3 border-top border-bottom network-item-body">
                                             <div class="overlap-rounded-circle">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Sophia Lee" src="img/p6.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="John Doe" src="img/p7.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Julia Cox" src="img/p8.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Robert Cook" src="img/p9.png" alt="">
                                             </div>
                                             <span class="font-weight-bold small text-primary">4 mutual connections</span>
                                          </div>
                                          <div class="network-item-footer py-3 d-flex text-center">
                                             <div class="col-6 pl-3 pr-1">
                                                <button type="button" class="btn btn-primary btn-sm btn-block"> Connect </button>
                                             </div>
                                             <div class="col-6 pr-3 pl-1">
                                                <button type="button" class="btn btn-outline-primary btn-sm btn-block"> <i class="feather-user-plus"></i> Follow </button>
                                             </div>
                                          </div>
                                       </div>
                                    </a>
                                 </div>
                                 <div class="col-md-4">
                                    <a href="profile.html">
                                       <div class="border network-item rounded mb-3">
                                          <div class="p-3 d-flex align-items-center network-item-header">
                                             <div class="dropdown-list-image mr-3">
                                                <img class="rounded-circle" src="img/p3.png" alt="">
                                             </div>
                                             <div class="font-weight-bold">
                                                <h6 class="font-weight-bold text-dark mb-0">Julia Cox</h6>
                                                <div class="small text-black-50">Art Designer</div>
                                             </div>
                                          </div>
                                          <div class="d-flex align-items-center p-3 border-top border-bottom network-item-body">
                                             <div class="overlap-rounded-circle">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Sophia Lee" src="img/p10.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="John Doe" src="img/p11.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Julia Cox" src="img/p12.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Robert Cook" src="img/p13.png" alt="">
                                             </div>
                                             <span class="font-weight-bold small text-primary">4 mutual connections</span>
                                          </div>
                                          <div class="network-item-footer py-3 d-flex text-center">
                                             <div class="col-6 pl-3 pr-1">
                                                <button type="button" class="btn btn-primary btn-sm btn-block"> Connect </button>
                                             </div>
                                             <div class="col-6 pr-3 pl-1">
                                                <button type="button" class="btn btn-outline-primary btn-sm btn-block"> <i class="feather-user-plus"></i> Follow </button>
                                             </div>
                                          </div>
                                       </div>
                                    </a>
                                 </div>
                                 <div class="col-md-4">
                                    <a href="profile.html">
                                       <div class="border network-item rounded mb-3">
                                          <div class="p-3 d-flex align-items-center network-item-header">
                                             <div class="dropdown-list-image mr-3">
                                                <img class="rounded-circle" src="img/p3.png" alt="">
                                             </div>
                                             <div class="font-weight-bold">
                                                <h6 class="font-weight-bold text-dark mb-0">Julia Cox</h6>
                                                <div class="small text-black-50">Art Designer</div>
                                             </div>
                                          </div>
                                          <div class="d-flex align-items-center p-3 border-top border-bottom network-item-body">
                                             <div class="overlap-rounded-circle">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Sophia Lee" src="img/p10.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="John Doe" src="img/p11.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Julia Cox" src="img/p12.png" alt="">
                                                <img class="rounded-circle shadow-sm" data-toggle="tooltip" data-placement="top" title="Robert Cook" src="img/p13.png" alt="">
                                             </div>
                                             <span class="font-weight-bold small text-primary">4 mutual connections</span>
                                          </div>
                                          <div class="network-item-footer py-3 d-flex text-center">
                                             <div class="col-6 pl-3 pr-1">
                                                <button type="button" class="btn btn-primary btn-sm btn-block"> Connect </button>
                                             </div>
                                             <div class="col-6 pr-3 pl-1">
                                                <button type="button" class="btn btn-outline-primary btn-sm btn-block"> <i class="feather-user-plus"></i> Follow </button>
                                             </div>
                                          </div>
                                       </div>
                                    </a>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="tab-pane fade" id="gz" role="tabpanel" aria-labelledby="profile-tab">
                           <div class="p-3 w-100">
                              <h6>Soon in next free update</h6>
                           </div>
                        </div>
                     </div>
                  </div>
               </main>
               <aside class="col col-xl-3 order-xl-2 col-lg-12 order-lg-2 col-12">
                  <div class="box mb-3 shadow-sm border rounded bg-white list-sidebar">
                     <div class="box-title p-3">
                        <h6 class="m-0">我的关注信息</h6>
                     </div>
                     <ul class="list-group list-group-flush">
                        <a href="#">
                           <li class="list-group-item pl-3 pr-3 d-flex align-items-center text-dark"><i class="feather-users mr-2 text-dark"></i> 关注 <span class="ml-auto font-weight-bold">{{userVo.gz}}</span></li>
                        </a>
                        <a href="#">
                           <li class="list-group-item pl-3 pr-3 d-flex align-items-center text-dark"><i class="feather-book mr-2 text-dark"></i> 粉丝 <span class="ml-auto font-weight-bold">{{userVo.fs}}</span></li>
                        </a>
                     </ul>
                  </div>
                  <div class="box shadow-sm mb-3 border rounded bg-white ads-box text-center">
                     <div class="image-overlap-2 pt-4">
                        <img src="img/l4.png" class="img-fluid rounded-circle shadow-sm" alt="Responsive image">
                        <img src="img/user.png" class="img-fluid rounded-circle shadow-sm" alt="Responsive image">
                     </div>
                     <div class="p-3 border-bottom">
                        <h6 class="text-dark">Gurdeep, grow your career by following <span class="font-weight-bold"> Askbootsrap</span></h6>
                        <p class="mb-0 text-muted">Stay up-to industry trends!</p>
                     </div>
                     <div class="p-3">
                        <button type="button" class="btn btn-outline-primary btn-sm pl-4 pr-4"> FOLLOW </button>
                     </div>
                  </div>
               </aside>
            </div>
         </div>
      </div>
   </div>
      <!-- Bootstrap core JavaScript -->
      <script th:src="@{/js/jquery.min.js}"></script>
      <script th:src="@{/bootstrap/js/bootstrap.bundle.min.js}"></script>
      <!-- slick Slider JS-->
      <script type="text/javascript" th:src="@{/assets/slick/slick.min.css}"></script>
      <!-- Custom scripts for all pages-->
      <script th:src="@{/js/osahan.js}"></script>
      <script th:src="@{/js/sweetalert.min.js}"></script>
      <!--vue-->
      <script th:src="@{/js/axios.min.js}"></script>
      <script th:src="@{/js/vue.min.js}"></script>
      <!--video-->
   <script type="text/javascript">
      const context = "[[@{/}]]";
      const sessionName = "[[${session.login_user.nickName}]]";


      function uploadPhoto() {
         $("#photo").click();
      }

      function uploadVideo() {
         $("#video").click();
      }

      new Vue({
         el: '#app',
         data: {
            context: context,
            vo: [
               {
                  post: {
                     user: {}
                  },
                  video: {},
                  photos: [],
                  commons: [
                     {
                        user: {},
                        post: {},
                     }
                  ]
               },
            ],
            userVo: {
               user: {}
            },
            pageNum: '1',
            canLoadMore: true,
            loadVideo:1,
         },

         methods: {
            postCommon: function (id, index) {
               axios({
                  url: context + "main/common",
                  method: 'post',
                  data: {text: $("#comText" + id).val(), post: {id: id}}
               }).then(response => {
                  if (response.data.result.code === 200) {
                     swal("回复成功", {icon: 'success', buttons: false, timer: 1000}).then(() => {
                        let newCommon = response.data.result.data;
                        console.log(newCommon);
                        this.$set(this.vo[index].commons, this.vo[index].commons.length, newCommon);
                        // this.vo[index].commons[this.vo[index].commons.length]=newCommon;
                     });
                  } else {
                     swal(response.data.result.msg[0], {icon: 'error'});
                  }
               }).catch(response => {
                  console.log(response);
               });
            },
            showCommons: function (id) {
               let dom = $("#commons" + id);
               if (dom.is(':hidden')) {
                  dom.show();
               } else {
                  dom.hide();
               }
            },
            unSub: function (id, event) {
               axios({
                  url: this.context + "main/sub/" + id,
                  method: 'delete',
               }).then(response => {
                  if (response.data.result.code === 200) {
                     swal(response.data.result.msg[0], {icon: 'success', buttons: false, timer: 1000});
                     const dom = $(event.target);
                     dom.hide();
                     dom.parent("li").prev("li").children("a").show();
                  } else {
                     swal(response.data.result.msg[0], {icon: 'error'});
                  }
               }).catch(response => {
                  console.log(response);
               });
            },
            sub: function (id, event) {
               if (id === this.userVo.user.id) {
                  swal("不能关注自己", {icon: "error", buttons: false, timer: 1000});
               } else {
                  axios({
                     url: this.context + "main/sub/" + id,
                     method: 'get',
                  }).then(response => {
                     if (response.data.result.code === 200) {
                        swal(response.data.result.msg[0], {icon: 'success', buttons: false, timer: 1000});
                        const dom = $(event.target);
                        dom.hide();
                        dom.parent("li").next("li").children("a").show();
                     } else {
                        swal(response.data.result.msg[0], {icon: 'error'});
                     }
                  }).catch(response => {
                     console.log(response);
                  });
               }
            },
            cancelGood(id, index, event) {
               axios({
                  url: this.context + "main/good/" + id,
                  method: 'delete',
               }).then(response => {
                  if (response.data.result.code === 200) {
                     swal("取消赞成功", {icon: "success", buttons: false, timer: 1000});
                     let dom = $(event.target);
                     if (dom.is("span")) {
                        dom = dom.parent("a");
                     }
                     this.vo[index].post.good--;
                     dom.hide();
                     dom.next("a").show();
                  } else {
                     swal(response.data.result.msg[0], {icon: 'error'});
                  }
               }).catch(response => {
                  console.log(response);
               });
            },
            good: function (id, index, event) {
               axios({
                  url: this.context + "main/good/" + id,
                  method: 'put',
               }).then(response => {
                  if (response.data.result.code === 200) {
                     swal("点赞成功", {icon: "success", buttons: false, timer: 1000});
                     let dom = $(event.target);
                     if (dom.is("span")) {
                        dom = dom.parent("a");
                     }
                     this.vo[index].post.good++;
                     dom.hide();
                     dom.prev("a").show();
                  }
               }).catch(response => {
                  console.log(response);
               });
            },
            postMyPost: function () {
               let formData = new FormData();
               if ($("#onlyFriend").prop('checked')) {
                  formData.append("onlyFriend", "1");
               }
               formData.append("video", $("#video")[0].files[0]);
               $.each($("#photo")[0].files, function (i, file) {
                  formData.append('photos', file);
               });
               formData.append("text", $("#text").val());
               $.ajax({
                  url: context + "main/post",
                  type: 'post',
                  processData: false,
                  contentType: false,
                  data: formData,
                  success: result => {
                     if (result.result.code === 200) {
                        swal("发表动态成功!", {icon: "success"}).then(function () {
                           window.location.reload();
                        });
                     } else {
                        swal(result.result.msg[0], {icon: "error"});
                     }
                  },
                  error: result => {
                     console.log(result);
                  }
               });
            },
            changePhotoSize: function (event) {
               const photo = $(event.target);//DOM对象转JQuery对象
               if (photo.hasClass("img-mini")) {
                  photo.removeClass("img-mini");
               } else {
                  photo.addClass("img-mini");
               }
            },
            deleteMyPost: function (id) {
               swal({
                  title: "是否确定删除动态？",
                  text: "删除无法恢复您的动态信息，是否继续？",
                  icon: "warning",
                  dangerMode: true,
                  buttons: ['取消', '删除'],
               }).then(result => {
                  if (result) {
                     axios({
                        url: context + "main/post",
                        method: 'delete',
                        params: {
                           id: id
                        }
                     }).then(response => {
                        if (response.data.result.code === 200) {
                           swal("删除动态成功！", {icon: 'success'}).then(function () {
                              window.location.reload();
                           });
                        } else {
                           swal(response.data.result.msg[0], {icon: 'error'});
                        }
                     }).catch(response => {
                        console.log(response);
                     });

                  }
               })
            },
            getPost: function () {
               const self = this;
               axios({
                  url: context + "main/post",
                  method: 'get',
                  params: {pageNum: this.pageNum++},
               }).then(function (response)  {
                  if (response.data.result.code === 200) {
                     console.log(response.data.result);
                     $.each(response.data.result.data, function (i, vo) {
                        if (self.vo.length === 1) {
                           self.$set(self.vo, i, vo);
                        } else {
                           self.$set(self.vo, self.vo.length, vo);
                        }
                        if(vo.video!=null){
                           self.$nextTick(function () {
                              let player = new Player({
                                 id: 'dse'+vo.post.id,
                                 url: $("#videoUrl"+vo.post.id).val(),
                                 fluid:true,
                              });
                           });
                        }
                     });
                  } else {
                     self.pageNum--;
                  }
               }).catch(function (response) {
                  console.log(response);
               });
            }
         },
         mounted: function () {
            // swal('vue is online!',{icon:'success'});
            const self = this;
            this.getPost();
            axios({
               url: context + "main/api/LoginUser",
               method: 'get',
            }).then(response => {
               if (response.data.result.code === 200) {
                  self.userVo = response.data.result.data;
               } else {
                  swal(response.data.result.msg[0], {icon: 'error'});
               }
            }).catch(response => {
               console.log(response);
            });
            window.addEventListener('scroll', function () {
               const scr = document.documentElement.scrollTop || document.body.scrollTop; // 向上滚动的那一部分高度
               const clientHeight = document.documentElement.clientHeight; // 屏幕高度也就是当前设备静态下你所看到的视觉高度
               const scrHeight = document.documentElement.scrollHeight || document.body.scrollHeight; // 整个网页的实际高度，兼容Pc端
               if (scr + clientHeight >= scrHeight) {
                  if (self.canLoadMore) { //this.isMoreLoad控制滚动是否加载更多
                     self.getPost();
                  } else {
                     return;
                  }
               }
            });

         }
      });
   </script>
   </body>
</html>